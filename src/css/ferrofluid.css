/* ============================================
   FERROFLUID SHAPES - Geometric Morphing Animation
   Goo that flows between quadrants forming shapes

   PERFORMANCE OPTIMIZED FOR 60FPS:
   - GPU-accelerated transforms
   - CSS containment
   - Compositor-only animations where possible
   ============================================ */

/* === CONTAINER === */
.ferro-container {
    position: relative;
    width: 300px;
    height: 300px;
    background: var(--canvas, #e8e0d0);
    border: var(--border-width, 3px) solid var(--ink, #4a2c2a);
    border-radius: var(--radius-lg, 16px);
    overflow: hidden;

    /* GPU ACCELERATION */
    transform: translate3d(0, 0, 0);
    perspective: 1000px;

    /* CSS CONTAINMENT - isolates repaints */
    contain: layout style paint;
    isolation: isolate;
}

.ferro-container--lg {
    width: 400px;
    height: 400px;
}

.ferro-container--sm {
    width: 200px;
    height: 200px;
}

.ferro-container--dark {
    background: var(--ink, #1a1412);
    border-color: var(--primary, #e07b3c);
}

/* === THE FERROFLUID GOO === */
.ferro-goo {
    position: absolute;
    width: 80px;
    height: 80px;
    background: linear-gradient(
        135deg,
        var(--burnt-orange, #e07b3c) 0%,
        var(--rust, #c2410c) 60%,
        var(--earth-dark, #5c3d2e) 100%
    );
    border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;

    /* ===== GPU ACCELERATION LAYER ===== */
    transform: translate3d(0, 0, 0);
    will-change: transform, clip-path;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;

    /* Force new stacking context */
    z-index: 1;

    /* Smooth subpixel rendering */
    -webkit-font-smoothing: antialiased;

    /* Static shadow - NOT animated */
    box-shadow:
        0 0 20px rgba(224, 123, 60, 0.4),
        0 0 40px rgba(224, 123, 60, 0.2),
        inset 0 0 20px rgba(255, 255, 255, 0.1);

    /* Smooth easing */
    animation: ferro-move 10s cubic-bezier(0.25, 0.1, 0.25, 1) infinite;
}

/* Color variants */
.ferro-goo--teal {
    background: linear-gradient(
        135deg,
        var(--teal, #0d9488) 0%,
        var(--accent-light, #14b8a6) 60%,
        #065f5b 100%
    );
    box-shadow:
        0 0 20px rgba(13, 148, 136, 0.4),
        0 0 40px rgba(13, 148, 136, 0.2),
        inset 0 0 20px rgba(255, 255, 255, 0.1);
}

.ferro-goo--gold {
    background: linear-gradient(
        135deg,
        var(--highlight, #fbbf24) 0%,
        #f59e0b 60%,
        #b45309 100%
    );
    box-shadow:
        0 0 20px rgba(251, 191, 36, 0.4),
        0 0 40px rgba(251, 191, 36, 0.2),
        inset 0 0 20px rgba(255, 255, 255, 0.15);
}

/* === MAIN ANIMATION ===
   Using ONLY transform for position (GPU accelerated)
   clip-path for shape morphing
*/
@keyframes ferro-move {
    /* Top-Left - TRIANGLE */
    0% {
        transform: translate3d(10%, 10%, 0) scale(1) rotate(0deg);
        clip-path: polygon(50% 5%, 5% 95%, 95% 95%);
    }

    /* Stretch toward top-right */
    12.5% {
        transform: translate3d(80%, 8%, 0) scale(1.2, 0.8) rotate(10deg);
        clip-path: polygon(20% 30%, 5% 90%, 95% 70%);
    }

    /* Top-Right - SQUARE */
    25% {
        transform: translate3d(150%, 10%, 0) scale(1) rotate(0deg);
        clip-path: polygon(5% 5%, 95% 5%, 95% 95%, 5% 95%);
    }

    /* Drip down */
    37.5% {
        transform: translate3d(155%, 90%, 0) scale(0.85, 1.25) rotate(-8deg);
        clip-path: polygon(15% 5%, 85% 5%, 95% 95%, 5% 85%);
    }

    /* Bottom-Right - CIRCLE */
    50% {
        transform: translate3d(150%, 170%, 0) scale(1) rotate(0deg);
        clip-path: ellipse(48% 48% at 50% 50%);
    }

    /* Stretch left */
    62.5% {
        transform: translate3d(70%, 175%, 0) scale(1.15, 0.85) rotate(5deg);
        clip-path: ellipse(55% 40% at 50% 50%);
    }

    /* Bottom-Left - PENTAGON */
    75% {
        transform: translate3d(10%, 170%, 0) scale(1) rotate(0deg);
        clip-path: polygon(50% 5%, 98% 38%, 80% 95%, 20% 95%, 2% 38%);
    }

    /* Pull up */
    87.5% {
        transform: translate3d(8%, 85%, 0) scale(0.8, 1.2) rotate(-10deg);
        clip-path: polygon(50% 5%, 85% 40%, 70% 95%, 30% 95%, 15% 40%);
    }

    /* Loop back */
    100% {
        transform: translate3d(10%, 10%, 0) scale(1) rotate(0deg);
        clip-path: polygon(50% 5%, 5% 95%, 95% 95%);
    }
}

/* === DRIP ELEMENTS - Transform-only animations === */
.ferro-goo::before,
.ferro-goo::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    background: inherit;
    border-radius: 50%;

    /* GPU acceleration */
    transform: translate3d(0, 0, 0);
    will-change: transform, opacity;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.ferro-goo::before {
    width: 24px;
    height: 24px;
    animation: ferro-drip-lead 10s cubic-bezier(0.25, 0.1, 0.25, 1) infinite;
}

.ferro-goo::after {
    width: 16px;
    height: 16px;
    animation: ferro-drip-trail 10s cubic-bezier(0.25, 0.1, 0.25, 1) infinite;
}

/* Transform-only keyframes (compositor thread, 60fps) */
@keyframes ferro-drip-lead {
    0%, 100% {
        transform: translate3d(-20px, -40px, 0) scale(0.6);
        opacity: 0.6;
    }
    12.5% {
        transform: translate3d(50px, -10px, 0) scale(1);
        opacity: 0.9;
    }
    25% {
        transform: translate3d(10px, -30px, 0) scale(0.5);
        opacity: 0.5;
    }
    37.5% {
        transform: translate3d(0px, 50px, 0) scale(0.9);
        opacity: 0.85;
    }
    50% {
        transform: translate3d(10px, 10px, 0) scale(0.4);
        opacity: 0.4;
    }
    62.5% {
        transform: translate3d(-60px, 0px, 0) scale(0.95);
        opacity: 0.9;
    }
    75% {
        transform: translate3d(10px, 10px, 0) scale(0.45);
        opacity: 0.5;
    }
    87.5% {
        transform: translate3d(-5px, -50px, 0) scale(0.85);
        opacity: 0.8;
    }
}

@keyframes ferro-drip-trail {
    0%, 100% {
        transform: translate3d(20px, 40px, 0) scale(0.5);
        opacity: 0.5;
    }
    12.5% {
        transform: translate3d(-40px, 20px, 0) scale(0.7);
        opacity: 0.7;
    }
    25% {
        transform: translate3d(20px, 40px, 0) scale(0.4);
        opacity: 0.4;
    }
    37.5% {
        transform: translate3d(20px, -50px, 0) scale(0.65);
        opacity: 0.65;
    }
    50% {
        transform: translate3d(20px, 20px, 0) scale(0.35);
        opacity: 0.35;
    }
    62.5% {
        transform: translate3d(70px, 10px, 0) scale(0.6);
        opacity: 0.6;
    }
    75% {
        transform: translate3d(20px, 20px, 0) scale(0.4);
        opacity: 0.4;
    }
    87.5% {
        transform: translate3d(30px, 60px, 0) scale(0.55);
        opacity: 0.55;
    }
}

/* === SPIKY VARIANT === */
.ferro-goo--spiky {
    animation: ferro-move-spiky 10s cubic-bezier(0.25, 0.1, 0.25, 1) infinite;
}

@keyframes ferro-move-spiky {
    /* Top-Left - SPIKY TRIANGLE */
    0%, 100% {
        transform: translate3d(10%, 10%, 0) scale(1) rotate(0deg);
        clip-path: polygon(
            50% 0%, 58% 20%, 75% 8%,
            65% 35%, 95% 45%,
            70% 60%, 90% 95%,
            50% 80%,
            10% 95%,
            30% 60%, 5% 45%,
            35% 35%, 25% 8%,
            42% 20%
        );
    }

    12.5% {
        transform: translate3d(80%, 8%, 0) scale(1.3, 0.7) rotate(15deg);
        clip-path: polygon(
            15% 35%, 35% 5%, 55% 25%, 75% 0%, 95% 45%,
            80% 60%, 95% 95%, 50% 75%, 5% 95%, 20% 60%, 5% 45%
        );
    }

    /* Top-Right - STAR */
    25% {
        transform: translate3d(150%, 10%, 0) scale(1) rotate(0deg);
        clip-path: polygon(
            50% 0%, 62% 32%, 98% 35%, 70% 55%, 80% 90%,
            50% 68%, 20% 90%, 30% 55%, 2% 35%, 38% 32%
        );
    }

    37.5% {
        transform: translate3d(155%, 90%, 0) scale(0.75, 1.35) rotate(-12deg);
        clip-path: polygon(
            35% 0%, 65% 0%, 75% 25%, 92% 15%, 82% 48%,
            98% 68%, 72% 98%, 28% 98%, 2% 68%, 18% 48%,
            8% 15%, 25% 25%
        );
    }

    /* Bottom-Right - HEXAGON */
    50% {
        transform: translate3d(150%, 170%, 0) scale(1) rotate(0deg);
        clip-path: polygon(
            25% 5%, 75% 5%, 98% 50%, 75% 95%, 25% 95%, 2% 50%
        );
    }

    62.5% {
        transform: translate3d(70%, 175%, 0) scale(1.25, 0.75) rotate(8deg);
        clip-path: polygon(
            0% 42%, 18% 18%, 48% 28%, 82% 18%, 100% 42%,
            88% 62%, 100% 88%, 50% 72%, 0% 88%, 12% 62%
        );
    }

    /* Bottom-Left - DIAMOND */
    75% {
        transform: translate3d(10%, 170%, 0) scale(1) rotate(0deg);
        clip-path: polygon(50% 2%, 98% 50%, 50% 98%, 2% 50%);
    }

    87.5% {
        transform: translate3d(8%, 85%, 0) scale(0.7, 1.3) rotate(-15deg);
        clip-path: polygon(
            28% 2%, 48% 12%, 72% 2%, 62% 38%, 98% 48%,
            62% 58%, 72% 98%, 48% 88%, 28% 98%, 38% 58%,
            2% 48%, 38% 38%
        );
    }
}

/* === QUADRANT GUIDES === */
.ferro-container--guides::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--line, #d4c4a8);
    opacity: 0.5;
    pointer-events: none;
    z-index: 0;
}

.ferro-container--guides::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 1px;
    background: var(--line, #d4c4a8);
    opacity: 0.5;
    pointer-events: none;
    z-index: 0;
}

/* === SPEED VARIANTS === */
.ferro-goo--slow {
    animation-duration: 16s;
}
.ferro-goo--slow::before,
.ferro-goo--slow::after {
    animation-duration: 16s;
}

.ferro-goo--fast {
    animation-duration: 5s;
}
.ferro-goo--fast::before,
.ferro-goo--fast::after {
    animation-duration: 5s;
}

/* === THEME VARIANTS === */

[data-theme="matrix"] .ferro-goo {
    background: linear-gradient(135deg, #00FF41 0%, #008F11 60%, #003B00 100%);
    box-shadow: 0 0 25px rgba(0, 255, 65, 0.5), 0 0 50px rgba(0, 255, 65, 0.25);
}

[data-theme="matrix"] .ferro-container {
    background: #0D0208;
    border-color: #00FF41;
}

[data-theme="dark"] .ferro-goo {
    box-shadow: 0 0 30px rgba(251, 146, 60, 0.45), 0 0 60px rgba(251, 146, 60, 0.2);
}

[data-theme="dark"] .ferro-container {
    background: var(--cream, #1a1412);
}

[data-theme="industrial-punchcard"] .ferro-container {
    box-shadow: 4px 4px 0 var(--chocolate, #3E2723);
}

/* === REDUCED MOTION === */
@media (prefers-reduced-motion: reduce) {
    .ferro-goo,
    .ferro-goo::before,
    .ferro-goo::after {
        animation: none;
        transform: translate3d(95%, 95%, 0);
        clip-path: ellipse(48% 48% at 50% 50%);
    }
}

/* === PAUSE ON HOVER === */
.ferro-container:hover .ferro-goo,
.ferro-container:hover .ferro-goo::before,
.ferro-container:hover .ferro-goo::after {
    animation-play-state: paused;
}

.ferro-container--no-pause:hover .ferro-goo,
.ferro-container--no-pause:hover .ferro-goo::before,
.ferro-container--no-pause:hover .ferro-goo::after {
    animation-play-state: running;
}

/* === OPTIONAL GOO FILTER (expensive but goopy) === */
.ferro-goo--gooey {
    filter: url(#ferro-goo-filter);
}
