<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PAGE_TITLE}} | Fogsift Wiki</title>
    <meta name="description" content="{{PAGE_DESCRIPTION}}">
    <meta name="author" content="Christopher Tavolazzi">
    <meta name="theme-color" content="#f5f0e6">
    <link rel="canonical" href="https://fogsift.com/wiki/{{PAGE_SLUG}}">

    <link rel="manifest" href="{{MANIFEST_PATH}}">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <meta property="og:title" content="{{PAGE_TITLE}} | Fogsift Wiki">
    <meta property="og:description" content="{{PAGE_DESCRIPTION}}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://fogsift.com/wiki/{{PAGE_SLUG}}">
    <meta property="og:image" content="https://fogsift.com/og-image.png">

    <link rel="icon" type="image/png" href="{{FAVICON_PATH}}">

    {{THEME_INIT}}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@400;500;700;900&family=JetBrains+Mono:wght@500;700&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{STYLES_PATH}}" id="main-styles">
</head>
<body class="wiki-body wiki-page">

    <div id="toast-container"></div>
    <div id="mobile-overlay" class="mobile-overlay" onclick="Nav.toggleMobile()" aria-hidden="true"></div>

    {{NAV_HEADER}}

    <div class="wiki-container">
        <!-- Breadcrumb -->
        <nav class="wiki-breadcrumb" aria-label="Breadcrumb">
            <ol class="wiki-breadcrumb__list">
                <li class="wiki-breadcrumb__item"><a href="{{ROOT_PATH}}" class="wiki-breadcrumb__link">FOGSIFT</a></li>
                <li class="wiki-breadcrumb__item wiki-breadcrumb__separator" aria-hidden="true">/</li>
                <li class="wiki-breadcrumb__item"><a href="{{WIKI_INDEX_PATH}}" class="wiki-breadcrumb__link">WIKI</a></li>
                <li class="wiki-breadcrumb__item wiki-breadcrumb__separator" aria-hidden="true">/</li>
                <li class="wiki-breadcrumb__item"><span class="wiki-breadcrumb__item--current" aria-current="page">{{BREADCRUMB}}</span></li>
            </ol>
        </nav>

        <!-- Sidebar -->
        <aside id="wiki-sidebar" class="wiki-sidebar" role="navigation" aria-label="Wiki navigation">
            <button type="button" class="wiki-sidebar__toggle" aria-expanded="false" aria-controls="wiki-sidebar-nav" onclick="WikiNav.toggle()">
                <span>Navigation</span>
                <span class="wiki-sidebar__toggle-icon" aria-hidden="true">+</span>
            </button>
            <div id="wiki-sidebar-nav" class="wiki-sidebar__nav">
                <a href="{{WIKI_INDEX_PATH}}" class="wiki-sidebar__home">
                    <span aria-hidden="true">&larr;</span> Wiki Home
                </a>
                {{WIKI_NAV}}
            </div>
        </aside>

        <!-- Main Content -->
        <main class="wiki-main" role="main">
            <article class="wiki-article">
                {{CONTENT}}
            </article>

            <footer class="wiki-article-footer">
                <div class="wiki-article-footer__meta">
                    <span>Updated: {{BUILD_DATE}}</span>
                </div>
                <nav class="wiki-article-footer__nav" aria-label="Wiki navigation">
                    <a href="{{WIKI_INDEX_PATH}}">
                        <span aria-hidden="true">&larr;</span> Back to Wiki
                    </a>
                </nav>
            </footer>

            {{JD_SITEMAP}}
        </main>
    </div>

    <script src="{{APP_PATH}}" defer></script>

    <script>
        const WikiNav = {
            sidebar: null,
            toggleBtn: null,
            navPanel: null,

            init() {
                this.sidebar = document.getElementById('wiki-sidebar');
                this.toggleBtn = document.querySelector('.wiki-sidebar__toggle');
                this.navPanel = document.getElementById('wiki-sidebar-nav');
                this.highlightActivePage();

                if (this.sidebar) {
                    this.sidebar.addEventListener('click', (e) => {
                        if (e.target.closest('.wiki-nav-list a')) {
                            setTimeout(() => this.close(), 150);
                        }
                    });
                }
            },

            toggle() {
                if (!this.toggleBtn) {
                    this.toggleBtn = document.querySelector('.wiki-sidebar__toggle');
                    this.navPanel = document.getElementById('wiki-sidebar-nav');
                }
                if (!this.sidebar) this.sidebar = document.getElementById('wiki-sidebar');
                if (!this.toggleBtn) return;

                const expanded = this.toggleBtn.getAttribute('aria-expanded') === 'true';
                this.toggleBtn.setAttribute('aria-expanded', String(!expanded));
                this.sidebar.classList.toggle('wiki-sidebar--open');

                const icon = this.toggleBtn.querySelector('.wiki-sidebar__toggle-icon');
                if (icon) icon.textContent = expanded ? '+' : '\u2212';
            },

            close() {
                if (!this.sidebar || !this.toggleBtn) return;
                this.toggleBtn.setAttribute('aria-expanded', 'false');
                this.sidebar.classList.remove('wiki-sidebar--open');
                const icon = this.toggleBtn.querySelector('.wiki-sidebar__toggle-icon');
                if (icon) icon.textContent = '+';
            },

            highlightActivePage() {
                const currentPage = window.location.pathname.split('/').pop();
                document.querySelectorAll('.wiki-nav-list a').forEach(link => {
                    const href = link.getAttribute('href');
                    if (href && (href === currentPage || href.endsWith(currentPage))) {
                        link.setAttribute('aria-current', 'page');
                        link.closest('li')?.classList.add('active');
                    }
                });
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => WikiNav.init());
        } else {
            WikiNav.init();
        }
    </script>
</body>
</html>
