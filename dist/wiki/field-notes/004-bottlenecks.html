<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Note: Finding the Bottleneck | Fogsift Wiki</title>
    <meta name="description" content="---">
    <meta name="author" content="Christopher Tavolazzi">
    <meta name="theme-color" content="#f5f0e6">
    <link rel="canonical" href="https://fogsift.com/wiki/field-notes/004-bottlenecks.html">

    <link rel="manifest" href="../../manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <meta property="og:title" content="Field Note: Finding the Bottleneck | Fogsift Wiki">
    <meta property="og:description" content="---">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://fogsift.com/wiki/field-notes/004-bottlenecks.html">
    <meta property="og:image" content="https://fogsift.com/og-image.png">

    <link rel="icon" type="image/png" href="../../favicon.png">

    <!-- Theme detection - inline to prevent FOUC -->
    <script>
        (function() {
            var t = localStorage.getItem('theme');
            var valid = ['light', 'dark', 'industrial-punchcard'];
            document.documentElement.setAttribute('data-theme', valid.includes(t) ? t : 'light');
        })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="../../styles.css">
</head>
<body class="wiki-body">

    <div id="toast-container"></div>

    <!-- Mobile Navigation Overlay (click to close) -->
    <div id="mobile-overlay" class="mobile-overlay" onclick="Nav.toggleMobile()" aria-hidden="true"></div>

    <nav id="mobile-drawer" class="mobile-drawer" aria-label="Mobile navigation">
        <button class="mobile-close" onclick="Nav.toggleMobile()" aria-label="Close menu">
            <span aria-hidden="true">&times;</span>
        </button>
        <a href="../../index.html" class="mobile-link">HOME</a>
        <a href="../index.html" class="mobile-link">WIKI</a>
        <a href="../../index.html#process" class="mobile-link">PROCESS</a>
        <a href="../../index.html#about" class="mobile-link">ABOUT</a>
        <a href="../../index.html#pricing" class="mobile-link">PRICING</a>
        <a href="mailto:christopher@fogsift.com?subject=Question%20for%20FogSift" class="mobile-link">CONTACT</a>
    </nav>

    <div class="nav-wrapper">
        <div class="main-nav">
            <a href="../../index.html" class="brand">
                <img src="../../assets/logo.png" alt="Fogsift" class="brand-logo">
            </a>

            <div class="menu-items">
                <div class="menu-item"><a href="../index.html" class="menu-link direct wiki-nav-active">WIKI</a></div>
                <div class="menu-item"><a href="../../index.html#process" class="menu-link">PROCESS</a></div>
                <div class="menu-item"><a href="../../index.html#about" class="menu-link">ABOUT</a></div>
                <div class="menu-item"><a href="../../index.html#pricing" class="menu-link">PRICING</a></div>
                <div class="menu-item"><a href="mailto:christopher@fogsift.com?subject=Question%20for%20FogSift" class="menu-link cta-link">CONTACT</a></div>
            </div>

            <div class="nav-controls">
                <div class="theme-selector">
                    <select class="theme-dropdown" onchange="Theme.onChange(event)" aria-label="Select theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="industrial-punchcard">Industrial</option>
                    </select>
                </div>
                <button class="menu-toggle" onclick="Nav.toggleMobile()" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-drawer">
                    <span class="menu-toggle-icon" aria-hidden="true">☰</span>
                </button>
            </div>
        </div>

        <nav class="breadcrumb-bar" aria-label="Breadcrumb">
            <ol class="crumb-list">
                <li class="crumb-item"><a href="../../index.html" class="crumb-link">FOGSIFT</a></li>
                <li class="crumb-item crumb-separator">/</li>
                <li class="crumb-item"><a href="../index.html" class="crumb-link">WIKI</a></li>
                <li class="crumb-item crumb-separator">/</li>
                <li class="crumb-item"><span class="crumb-current">BOTTLENECKS</span></li>
            </ol>
        </nav>
    </div>

    <div class="wiki-layout">
        <!-- Mobile Sidebar Toggle -->
        <button class="wiki-sidebar-toggle" aria-expanded="false" aria-controls="wiki-sidebar" onclick="WikiNav.toggle()">
            <span class="toggle-text">Navigation</span>
            <span class="toggle-icon" aria-hidden="true">+</span>
        </button>

        <!-- Sidebar Navigation -->
        <aside id="wiki-sidebar" class="wiki-sidebar" role="navigation" aria-label="Wiki navigation">
            <div class="wiki-sidebar-inner">
                <div class="wiki-sidebar-header">
                    <a href="../index.html" class="wiki-home-link">
                        <span aria-hidden="true">←</span> Wiki Home
                    </a>
                </div>
                <div class="wiki-sidebar-content">
                    <div class="wiki-nav-category">
  <h4 class="wiki-nav-title"><span class="wiki-nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="14" y2="10"></line></svg></span>Documentation</h4>
  <ul class="wiki-nav-list">
    <li><a href="../getting-started.html">Getting Started</a></li>
    <li><a href="../how-we-work.html">How We Work</a></li>
    <li><a href="../diagnostic-process.html">The Diagnostic Process</a></li>
    <li><a href="../faq.html">Frequently Asked Questions</a></li>
  </ul>
</div>
<div class="wiki-nav-category">
  <h4 class="wiki-nav-title"><span class="wiki-nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18h6"></path><path d="M10 22h4"></path><path d="M12 2a7 7 0 0 0-4 12.7V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.3A7 7 0 0 0 12 2z"></path></svg></span>Concepts</h4>
  <ul class="wiki-nav-list">
    <li><a href="../concepts/root-cause.html">Root Cause Analysis</a></li>
    <li><a href="../concepts/mental-models.html">Mental Models</a></li>
    <li><a href="../concepts/systems-thinking.html">Systems Thinking</a></li>
    <li><a href="../concepts/cognitive-biases.html">Cognitive Biases</a></li>
    <li><a href="../concepts/second-order-effects.html">Second-Order Effects</a></li>
    <li><a href="../concepts/signal-vs-noise.html">Signal vs Noise</a></li>
  </ul>
</div>
<div class="wiki-nav-category">
  <h4 class="wiki-nav-title"><span class="wiki-nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></svg></span>Frameworks</h4>
  <ul class="wiki-nav-list">
    <li><a href="../frameworks/trace-protocol.html">The TRACE Protocol</a></li>
    <li><a href="../frameworks/decision-matrix.html">Decision Matrix</a></li>
    <li><a href="../frameworks/constraint-mapping.html">Constraint Mapping</a></li>
    <li><a href="../frameworks/feedback-loops.html">Feedback Loop Analysis</a></li>
  </ul>
</div>
<div class="wiki-nav-category">
  <h4 class="wiki-nav-title"><span class="wiki-nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg></span>Field Notes</h4>
  <ul class="wiki-nav-list">
    <li><a href="../field-notes/001-map-territory.html">The Map Is Not The Territory</a></li>
    <li><a href="../field-notes/002-precision-accuracy.html">Precision vs Accuracy</a></li>
    <li><a href="../field-notes/003-entropy.html">Entropy</a></li>
    <li><a href="../field-notes/004-bottlenecks.html" class="active">Finding the Bottleneck</a></li>
    <li><a href="../field-notes/005-tribal-knowledge.html">Tribal Knowledge</a></li>
    <li><a href="../field-notes/006-incentive-alignment.html">Incentive Alignment</a></li>
    <li><a href="../field-notes/007-documentation-debt.html">Documentation Debt</a></li>
  </ul>
</div>
<div class="wiki-nav-category">
  <h4 class="wiki-nav-title"><span class="wiki-nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg></span>Case Studies</h4>
  <ul class="wiki-nav-list">
    <li><a href="../case-studies/manufacturing-throughput.html">Manufacturing Throughput Crisis</a></li>
    <li><a href="../case-studies/communication-breakdown.html">The Communication Breakdown</a></li>
    <li><a href="../case-studies/the-invisible-process.html">The Invisible Process</a></li>
  </ul>
</div>
<div class="wiki-nav-category">
  <h4 class="wiki-nav-title"><span class="wiki-nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg></span>Tools & Techniques</h4>
  <ul class="wiki-nav-list">
    <li><a href="../tools/five-whys.html">The Five Whys</a></li>
    <li><a href="../tools/fishbone-diagram.html">Fishbone Diagrams</a></li>
    <li><a href="../tools/pareto-analysis.html">Pareto Analysis</a></li>
    <li><a href="../tools/process-mapping.html">Process Mapping</a></li>
  </ul>
</div>

                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="wiki-main" role="main">
            <article class="wiki-content">
                <h1>Field Note: Finding the Bottleneck</h1>
<p><strong>Date:</strong> 2025-01-20
<strong>Sector:</strong> OPERATIONS
<strong>Read Time:</strong> 4 minutes</p>
<hr>
<p>Every system has a bottleneck. The constraint that limits throughput. The thing that, if you improved it, would improve everything. The thing that, if you ignore it, makes all other improvements irrelevant.</p>
<h2>The Observation</h2>
<p>Client had a manufacturing operation. They&#39;d invested heavily in automation on the production floor. State-of-the-art equipment. Impressive cycle times. And yet, output was flat.</p>
<p>Everyone had theories:</p>
<ul>
<li>&quot;We need more floor space&quot;</li>
<li>&quot;The equipment isn&#39;t running at capacity&quot;</li>
<li>&quot;We need more shifts&quot;</li>
</ul>
<p>We walked the floor. Watched the flow. Asked one question at every station: &quot;What are you waiting for?&quot;</p>
<p>The bottleneck wasn&#39;t on the production floor. It was in the quality lab. Every batch needed certification. The lab was understaffed, working overtime, and still couldn&#39;t keep up. Production sat waiting. All that automation produced material that queued for inspection.</p>
<h2>The Principle</h2>
<p><strong>The Theory of Constraints:</strong> A chain is only as strong as its weakest link. A system only produces as fast as its slowest process.</p>
<p>Investing anywhere except the bottleneck is waste. No matter how fast the other stations get, the bottleneck determines output. If inspection can handle 100 units per day, you can never ship more than 100 units per day, no matter how much production capacity you have.</p>
<h2>Finding Your Bottleneck</h2>
<h3>Method 1: Follow the Queue</h3>
<p>Where does work pile up? Where do people wait? Where do things sit before moving to the next step? That&#39;s probably the bottleneck.</p>
<h3>Method 2: Calculate Capacity</h3>
<p>For each step in your process, calculate how much it can handle per unit time. The step with the lowest capacity is the bottleneck.</p>
<h3>Method 3: Ask the People</h3>
<p>The people doing the work usually know. Ask: &quot;What&#39;s the biggest barrier to getting more done?&quot; Listen without defending.</p>
<h2>What to Do With the Bottleneck</h2>
<p>Once you&#39;ve found it:</p>
<ol>
<li><p><strong>Exploit it:</strong> Make sure the bottleneck is never starved for input or blocked from output. It should never wait.</p>
</li>
<li><p><strong>Subordinate to it:</strong> All other processes should operate at the pace the bottleneck can handle. Producing faster upstream just creates inventory.</p>
</li>
<li><p><strong>Elevate it:</strong> If you need more capacity, invest in the bottleneck first. Not elsewhere.</p>
</li>
<li><p><strong>Repeat:</strong> Once you fix this bottleneck, something else becomes the bottleneck. Find it and start again.</p>
</li>
</ol>
<h2>The Resolution</h2>
<p>The client didn&#39;t need more production equipment. They needed two more lab technicians and a faster testing protocol.</p>
<p>Cost: ~$200K per year in salary
Result: 40% increase in output
ROI: Measured in weeks</p>
<p>The automation investment was fine. It just couldn&#39;t realize its value until the bottleneck moved.</p>
<h2>The Meta-Lesson</h2>
<p>The bottleneck is often not where you expect it. And it&#39;s almost never where the organization is investing.</p>
<p>High-performing operations don&#39;t ask &quot;how do we improve?&quot; They ask &quot;what&#39;s the bottleneck?&quot; and then improve only that.</p>
<hr>
<p><em>Efficiency everywhere is waste. Efficiency at the bottleneck is leverage.</em></p>

            </article>

            <footer class="wiki-footer">
                <div class="wiki-meta">
                    <span>Updated: 2025-12-28</span>
                </div>
                <nav class="wiki-nav-footer" aria-label="Wiki navigation">
                    <a href="../index.html">
                        <span aria-hidden="true">←</span> Back to Wiki
                    </a>
                </nav>
            </footer>

            <div class="jd-sitemap">
  <div class="jd-sitemap-header">
    <h3 class="jd-sitemap-title">Sitemap</h3>
  </div>
  <div class="jd-sitemap-grid">
    <div class="jd-category">
      <div class="jd-category-header">
        <span class="jd-range">10-19</span>
        <h4 class="jd-category-name">Documentation</h4>
      </div>
      <ul class="jd-pages">
        <li>
          <a href="../getting-started.html" class="jd-page-link">
            <span class="jd-number">10.01</span>
            <span class="jd-page-title">Getting Started</span>
          </a>
        </li>
        <li>
          <a href="../how-we-work.html" class="jd-page-link">
            <span class="jd-number">10.02</span>
            <span class="jd-page-title">How We Work</span>
          </a>
        </li>
        <li>
          <a href="../diagnostic-process.html" class="jd-page-link">
            <span class="jd-number">10.03</span>
            <span class="jd-page-title">The Diagnostic Process</span>
          </a>
        </li>
        <li>
          <a href="../faq.html" class="jd-page-link">
            <span class="jd-number">10.04</span>
            <span class="jd-page-title">Frequently Asked Questions</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="jd-category">
      <div class="jd-category-header">
        <span class="jd-range">20-29</span>
        <h4 class="jd-category-name">Concepts</h4>
      </div>
      <ul class="jd-pages">
        <li>
          <a href="../concepts/root-cause.html" class="jd-page-link">
            <span class="jd-number">20.01</span>
            <span class="jd-page-title">Root Cause Analysis</span>
          </a>
        </li>
        <li>
          <a href="../concepts/mental-models.html" class="jd-page-link">
            <span class="jd-number">20.02</span>
            <span class="jd-page-title">Mental Models</span>
          </a>
        </li>
        <li>
          <a href="../concepts/systems-thinking.html" class="jd-page-link">
            <span class="jd-number">20.03</span>
            <span class="jd-page-title">Systems Thinking</span>
          </a>
        </li>
        <li>
          <a href="../concepts/cognitive-biases.html" class="jd-page-link">
            <span class="jd-number">20.04</span>
            <span class="jd-page-title">Cognitive Biases</span>
          </a>
        </li>
        <li>
          <a href="../concepts/second-order-effects.html" class="jd-page-link">
            <span class="jd-number">20.05</span>
            <span class="jd-page-title">Second-Order Effects</span>
          </a>
        </li>
        <li>
          <a href="../concepts/signal-vs-noise.html" class="jd-page-link">
            <span class="jd-number">20.06</span>
            <span class="jd-page-title">Signal vs Noise</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="jd-category">
      <div class="jd-category-header">
        <span class="jd-range">30-39</span>
        <h4 class="jd-category-name">Frameworks</h4>
      </div>
      <ul class="jd-pages">
        <li>
          <a href="../frameworks/trace-protocol.html" class="jd-page-link">
            <span class="jd-number">30.01</span>
            <span class="jd-page-title">The TRACE Protocol</span>
          </a>
        </li>
        <li>
          <a href="../frameworks/decision-matrix.html" class="jd-page-link">
            <span class="jd-number">30.02</span>
            <span class="jd-page-title">Decision Matrix</span>
          </a>
        </li>
        <li>
          <a href="../frameworks/constraint-mapping.html" class="jd-page-link">
            <span class="jd-number">30.03</span>
            <span class="jd-page-title">Constraint Mapping</span>
          </a>
        </li>
        <li>
          <a href="../frameworks/feedback-loops.html" class="jd-page-link">
            <span class="jd-number">30.04</span>
            <span class="jd-page-title">Feedback Loop Analysis</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="jd-category">
      <div class="jd-category-header">
        <span class="jd-range">40-49</span>
        <h4 class="jd-category-name">Field Notes</h4>
      </div>
      <ul class="jd-pages">
        <li>
          <a href="../field-notes/001-map-territory.html" class="jd-page-link">
            <span class="jd-number">40.01</span>
            <span class="jd-page-title">The Map Is Not The Territory</span>
          </a>
        </li>
        <li>
          <a href="../field-notes/002-precision-accuracy.html" class="jd-page-link">
            <span class="jd-number">40.02</span>
            <span class="jd-page-title">Precision vs Accuracy</span>
          </a>
        </li>
        <li>
          <a href="../field-notes/003-entropy.html" class="jd-page-link">
            <span class="jd-number">40.03</span>
            <span class="jd-page-title">Entropy</span>
          </a>
        </li>
        <li>
          <a href="../field-notes/004-bottlenecks.html" class="jd-page-link">
            <span class="jd-number">40.04</span>
            <span class="jd-page-title">Finding the Bottleneck</span>
          </a>
        </li>
        <li>
          <a href="../field-notes/005-tribal-knowledge.html" class="jd-page-link">
            <span class="jd-number">40.05</span>
            <span class="jd-page-title">Tribal Knowledge</span>
          </a>
        </li>
        <li>
          <a href="../field-notes/006-incentive-alignment.html" class="jd-page-link">
            <span class="jd-number">40.06</span>
            <span class="jd-page-title">Incentive Alignment</span>
          </a>
        </li>
        <li>
          <a href="../field-notes/007-documentation-debt.html" class="jd-page-link">
            <span class="jd-number">40.07</span>
            <span class="jd-page-title">Documentation Debt</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="jd-category">
      <div class="jd-category-header">
        <span class="jd-range">50-59</span>
        <h4 class="jd-category-name">Case Studies</h4>
      </div>
      <ul class="jd-pages">
        <li>
          <a href="../case-studies/manufacturing-throughput.html" class="jd-page-link">
            <span class="jd-number">50.01</span>
            <span class="jd-page-title">Manufacturing Throughput Crisis</span>
          </a>
        </li>
        <li>
          <a href="../case-studies/communication-breakdown.html" class="jd-page-link">
            <span class="jd-number">50.02</span>
            <span class="jd-page-title">The Communication Breakdown</span>
          </a>
        </li>
        <li>
          <a href="../case-studies/the-invisible-process.html" class="jd-page-link">
            <span class="jd-number">50.03</span>
            <span class="jd-page-title">The Invisible Process</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="jd-category">
      <div class="jd-category-header">
        <span class="jd-range">60-69</span>
        <h4 class="jd-category-name">Tools & Techniques</h4>
      </div>
      <ul class="jd-pages">
        <li>
          <a href="../tools/five-whys.html" class="jd-page-link">
            <span class="jd-number">60.01</span>
            <span class="jd-page-title">The Five Whys</span>
          </a>
        </li>
        <li>
          <a href="../tools/fishbone-diagram.html" class="jd-page-link">
            <span class="jd-number">60.02</span>
            <span class="jd-page-title">Fishbone Diagrams</span>
          </a>
        </li>
        <li>
          <a href="../tools/pareto-analysis.html" class="jd-page-link">
            <span class="jd-number">60.03</span>
            <span class="jd-page-title">Pareto Analysis</span>
          </a>
        </li>
        <li>
          <a href="../tools/process-mapping.html" class="jd-page-link">
            <span class="jd-number">60.04</span>
            <span class="jd-page-title">Process Mapping</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
  <div class="jd-sitemap-footer">
    <p class="jd-sitemap-note">Organized using the <a href="https://johnnydecimal.com/" target="_blank" rel="noopener">Johnny Decimal</a> system</p>
  </div>
</div>

        </main>
    </div>

    <!-- Minimal JS for wiki pages - Event-driven theme system -->
    <script>
        // Theme system (event-driven, cross-tab sync)
        const Theme = {
            THEMES: ['light', 'dark', 'industrial-punchcard'],
            LABELS: { 'light': 'Light', 'dark': 'Dark', 'industrial-punchcard': 'Industrial' },
            _initialized: false,

            get() {
                return document.documentElement.getAttribute('data-theme') || 'light';
            },

            set(theme, notify = true) {
                if (!this.THEMES.includes(theme)) theme = 'light';
                const prev = this.get();
                if (prev === theme) return;

                document.documentElement.setAttribute('data-theme', theme);
                try { localStorage.setItem('theme', theme); } catch {}
                this._hydrateDropdowns();

                // Dispatch event for any listeners
                window.dispatchEvent(new CustomEvent('themechange', {
                    detail: { theme, previousTheme: prev }
                }));

                // Show toast if available
                if (notify && typeof Toast !== 'undefined') {
                    Toast.show('VISUAL MODE: ' + this.LABELS[theme].toUpperCase());
                }
            },

            onChange(event) {
                this.set(event.target.value);
            },

            _hydrateDropdowns() {
                const current = this.get();
                document.querySelectorAll('.theme-dropdown').forEach(d => {
                    if (d.value !== current) d.value = current;
                });
            },

            init() {
                if (this._initialized) return;
                this._initialized = true;

                // Apply stored theme
                const stored = localStorage.getItem('theme');
                const theme = this.THEMES.includes(stored) ? stored : 'light';
                document.documentElement.setAttribute('data-theme', theme);
                this._hydrateDropdowns();

                // Cross-tab sync via storage events
                window.addEventListener('storage', (e) => {
                    if (e.key === 'theme' && e.newValue && this.THEMES.includes(e.newValue)) {
                        if (e.newValue !== this.get()) {
                            document.documentElement.setAttribute('data-theme', e.newValue);
                            this._hydrateDropdowns();
                        }
                    }
                });
            }
        };

        // Initialize theme on load
        Theme.init();

        // Mobile nav
        const Nav = {
            toggleMobile() {
                const drawer = document.getElementById('mobile-drawer');
                const overlay = document.getElementById('mobile-overlay');
                const isOpen = drawer?.classList.contains('open');
                if (isOpen) {
                    drawer?.classList.remove('open');
                    overlay?.classList.remove('open');
                    document.body.classList.remove('scroll-locked');
                } else {
                    drawer?.classList.add('open');
                    overlay?.classList.add('open');
                    document.body.classList.add('scroll-locked');
                }
            }
        };

        // Wiki sidebar accordion toggle
        const WikiNav = {
            sidebar: null,
            toggle: null,

            init() {
                this.sidebar = document.getElementById('wiki-sidebar');
                this.toggleBtn = document.querySelector('.wiki-sidebar-toggle');

                // Mark active page in navigation
                this.highlightActivePage();

                // Auto-close sidebar when clicking nav links (mobile/tablet)
                if (this.sidebar) {
                    this.sidebar.addEventListener('click', (e) => {
                        if (e.target.closest('.wiki-nav-list a')) {
                            // Small delay for visual feedback before close
                            setTimeout(() => this.close(), 150);
                        }
                    });
                }
            },

            toggle() {
                if (!this.sidebar || !this.toggleBtn) {
                    this.sidebar = document.getElementById('wiki-sidebar');
                    this.toggleBtn = document.querySelector('.wiki-sidebar-toggle');
                }
                if (!this.sidebar || !this.toggleBtn) return;

                const expanded = this.toggleBtn.getAttribute('aria-expanded') === 'true';
                this.toggleBtn.setAttribute('aria-expanded', !expanded);
                this.sidebar.classList.toggle('open');

                // Update toggle icon with smooth transition
                const icon = this.toggleBtn.querySelector('.toggle-icon');
                if (icon) {
                    icon.textContent = expanded ? '+' : '−';
                }
            },

            close() {
                if (!this.sidebar || !this.toggleBtn) return;
                this.toggleBtn.setAttribute('aria-expanded', 'false');
                this.sidebar.classList.remove('open');
                const icon = this.toggleBtn.querySelector('.toggle-icon');
                if (icon) icon.textContent = '+';
            },

            highlightActivePage() {
                // Get current page path
                const currentPath = window.location.pathname;
                const currentPage = currentPath.split('/').pop();

                // Find and mark active link
                const navLinks = document.querySelectorAll('.wiki-nav-list a');
                navLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href && (href === currentPage || href.endsWith(currentPage))) {
                        link.setAttribute('aria-current', 'page');
                        link.closest('li')?.classList.add('active');
                    }
                });
            }
        };

        // Initialize WikiNav
        WikiNav.init();

        // Toast (minimal)
        const Toast = {
            show(msg) {
                const container = document.getElementById('toast-container');
                if (!container) return;
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = msg;
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        };
    </script>
</body>
</html>

