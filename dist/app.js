const Toast={containerId:"toast-container",defaultDuration:2500,errorDuration:5e3,getContainer(){let e=document.getElementById(this.containerId);return e||(e=document.createElement("div"),e.id=this.containerId,document.body.appendChild(e)),e},show(e,t=this.defaultDuration){this._create(e,"success",t)},error(e,t=this.errorDuration){this._create(e,"error",t,!0)},info(e,t=this.defaultDuration){this._create(e,"info",t)},_create(e,t="success",s,n=!1){const i=this.getContainer(),a=document.createElement("div");a.className=`toast toast--${t}`;const o=document.createElement("span");if(o.className="toast__message",o.innerText=e,a.appendChild(o),n){const l=document.createElement("button");l.className="toast__copy",l.innerHTML="[COPY]",l.title="Copy error to clipboard",l.onclick=c=>{c.stopPropagation(),navigator.clipboard.writeText(e).then(()=>{l.innerHTML="[COPIED]",setTimeout(()=>l.innerHTML="[COPY]",1e3)}).catch(()=>{l.innerHTML="[FAILED]",setTimeout(()=>l.innerHTML="[COPY]",1e3)})},a.appendChild(l)}i.appendChild(a);const r=setTimeout(()=>{this._dismiss(a)},s);a.addEventListener("click",l=>{l.target.classList.contains("toast__copy")||(clearTimeout(r),this._dismiss(a))})},_dismiss(e){e.style.animation="slideOut 0.2s ease forwards",setTimeout(()=>e.remove(),200)}},Theme={STORAGE_KEY:"theme",init(){let e="light";try{e=localStorage.getItem(this.STORAGE_KEY)||"light"}catch{}this.set(e,!1)},get(){return document.documentElement.getAttribute("data-theme")||"light"},set(e,t=!0){document.documentElement.setAttribute("data-theme",e);try{localStorage.setItem(this.STORAGE_KEY,e)}catch(s){console.warn("Theme: Could not persist preference:",s.message)}t&&typeof Toast<"u"&&Toast.show(`VISUAL MODE: ${e.toUpperCase()}`)},toggle(){const t=this.get()==="dark"?"light":"dark";this.set(t)}};typeof window<"u"&&Theme.init();const Modal={elementId:"article-modal",articles:null,articlesPath:"content/articles.json",getElement(){return document.getElementById(this.elementId)},async loadArticles(){if(this.articles)return this.articles;try{const e=await fetch(this.articlesPath);if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();return this.articles={},t.articles.forEach(s=>{this.articles[s.id]=s}),this.articles}catch(e){return console.warn("Failed to load articles:",e.message),typeof Toast<"u"&&Toast.error("Could not load articles. Check connection."),{}}},open(e){const t=this.getElement(),s=document.getElementById("modal-title"),n=document.getElementById("modal-body");document.body.classList.add("scroll-locked"),s.innerText=`RETRIEVING LOG ${e}...`,n.innerHTML="<p>Decryption in progress...</p>",t.style.display="block",setTimeout(()=>{t.style.opacity=1},10),setTimeout(()=>this.loadContent(e,s,n),500)},close(){const e=this.getElement();e.style.opacity=0,document.body.classList.remove("scroll-locked"),setTimeout(()=>{e.style.display="none"},300)},async loadContent(e,t,s){const i=(await this.loadArticles())[e];if(i){const a=`TIMESTAMP: ${i.date} // ${i.sector}`;t.innerText=i.title,s.textContent="";const o=document.createElement("p");o.className="mono",o.style.color="var(--muted)",o.textContent=a;const r=document.createElement("hr");r.style.cssText="border:0; border-top:1px solid var(--line); margin: 2rem 0;";const l=document.createElement("p");l.textContent=i.body,s.appendChild(o),s.appendChild(r),s.appendChild(l)}else{t.innerText="LOG NOT FOUND",s.textContent="";const a=document.createElement("p");a.textContent="The requested field note could not be retrieved.",s.appendChild(a)}},init(){const e=this.getElement();e&&e.addEventListener("click",t=>{t.target===e&&this.close()}),this.loadArticles()}},Nav={drawerId:"mobile-drawer",toggleMobile(){const e=document.getElementById(this.drawerId);e.classList.contains("open")?(e.classList.remove("open"),document.body.classList.remove("scroll-locked")):(e.classList.add("open"),document.body.classList.add("scroll-locked"))},init(){}},SleepMode={PAGE_TIME_REQUIRED:300*1e3,IDLE_TIME_REQUIRED:30*1e3,CHECK_INTERVAL:5e3,TIMING:{OVERLAY_DELAY:300,BREATHING_START:1500,WAKE_FLASH_DURATION:150,OVERLAY_FADE:500,ELEMENT_CLEANUP_DELAY:700,STAGGER_BUTTONS:100,STAGGER_CARDS:150,STAGGER_TEXT:80,STAGGER_NAV:50,STAGGER_STARTLE:30,STARTLED_MARK_DURATION:600},DISPLAY:{MOBILE_BREAKPOINT:768,TOASTERS_PER_200PX:1,TOASTERS_MOBILE:2,Z_COUNT_DESKTOP:8,Z_COUNT_MOBILE:4,ZS_PER_ELEMENT:3},CANVAS:{TOASTER_MIN_SPEED:1,TOASTER_SPEED_RANGE:1.5,WING_SPEED_MIN:5,WING_SPEED_RANGE:5,WRAP_MARGIN:60,PIXEL_SCALE:3},pageLoadTime:Date.now(),lastActivityTime:Date.now(),isAsleep:!1,checkTimer:null,overlay:null,canvas:null,ctx:null,animationFrame:null,toasters:[],zs:[],sleepyElements:[],decorations:[],breathingTimeout:null,resizeHandler:null,wakeHandler:null,SLEEPY_SELECTORS:{buttons:".cta-button, .pricing-cta, .theme-toggle, .menu-toggle",cards:".process-step, .pricing-card, .about-card, .hero-badge, .wiki-category-card",text:".headline, .subhead, .section-label, .about-name, main h1, main h2, main h3",nav:".menu-link",logo:".brand-logo"},prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches},init(){this.pageLoadTime=Date.now(),this.lastActivityTime=Date.now(),this.bindActivityListeners(),this.startChecking(),console.log("%c \u{1F4A4} Psst... stay a while and something might happen... ","background: #4a2c2a; color: #e07b3c; padding: 5px; font-family: monospace; font-size: 10px;")},bindActivityListeners(){const e=()=>{this.lastActivityTime=Date.now()};document.addEventListener("mousemove",e,{passive:!0}),document.addEventListener("keydown",e,{passive:!0}),document.addEventListener("scroll",e,{passive:!0}),document.addEventListener("touchstart",e,{passive:!0})},startChecking(){this.checkTimer=setInterval(()=>this.checkSleepConditions(),this.CHECK_INTERVAL)},checkSleepConditions(){if(this.isAsleep)return;const e=Date.now(),t=e-this.pageLoadTime,s=e-this.lastActivityTime;t>=this.PAGE_TIME_REQUIRED&&s>=this.IDLE_TIME_REQUIRED&&this.enterSleepMode()},enterSleepMode(){this.isAsleep||(this.isAsleep=!0,console.log("%c \u{1F634} FOGSIFT is taking a nap... click anywhere to wake up! ","background: #1a1412; color: #fb923c; padding: 10px; font-family: monospace; font-weight: bold;"),document.body.classList.add("page-sleeping"),this.prefersReducedMotion()||this.putElementsToSleep(),setTimeout(()=>{this.createOverlay(),this.prefersReducedMotion()||(this.initToasters(),this.initZs(),this.startAnimation()),this.wakeHandler=()=>this.wakeUp(),this.overlay.addEventListener("click",this.wakeHandler),this.overlay.addEventListener("touchend",this.wakeHandler,{passive:!0})},this.TIMING.OVERLAY_DELAY))},putElementsToSleep(){this.sleepyElements=[],this.decorations=[],document.querySelectorAll(this.SLEEPY_SELECTORS.buttons).forEach((t,s)=>{setTimeout(()=>{this.prepareElement(t),t.classList.add("sleepy"),this.sleepyElements.push({element:t,type:"button"}),s%2===0&&this.addZzzToElement(t)},s*this.TIMING.STAGGER_BUTTONS)}),document.querySelectorAll(this.SLEEPY_SELECTORS.cards).forEach((t,s)=>{setTimeout(()=>{this.prepareElement(t),t.classList.add("sleepy"),this.sleepyElements.push({element:t,type:"card"}),s<3&&this.addSleepCap(t),s===1&&this.addSnoreBubble(t),this.addZzzToElement(t)},2*this.TIMING.STAGGER_BUTTONS+s*this.TIMING.STAGGER_CARDS)}),document.querySelectorAll(this.SLEEPY_SELECTORS.text).forEach((t,s)=>{setTimeout(()=>{t.classList.add("sleepy"),this.sleepyElements.push({element:t,type:"text"})},this.TIMING.STAGGER_BUTTONS+s*this.TIMING.STAGGER_TEXT)}),document.querySelectorAll(this.SLEEPY_SELECTORS.nav).forEach((t,s)=>{setTimeout(()=>{t.classList.add("sleepy"),this.sleepyElements.push({element:t,type:"nav"})},s*this.TIMING.STAGGER_NAV)});const e=document.querySelector(this.SLEEPY_SELECTORS.logo);e&&setTimeout(()=>{this.prepareElement(e),e.classList.add("sleepy"),this.sleepyElements.push({element:e,type:"logo"}),this.addZzzToElement(e),this.addSleepCap(e)},this.TIMING.STAGGER_BUTTONS),this.breathingTimeout=setTimeout(()=>{this.startBreathing()},this.TIMING.BREATHING_START)},prepareElement(e){window.getComputedStyle(e).position==="static"&&(e.dataset.sleepOriginalPosition="static",e.style.position="relative")},restoreElement(e){e.dataset.sleepOriginalPosition==="static"&&(e.style.position="",delete e.dataset.sleepOriginalPosition)},startBreathing(){this.isAsleep&&this.sleepyElements.forEach(({element:e})=>{e.classList.remove("sleepy"),e.classList.add("sleepy-breathing")})},addZzzToElement(e){const t=document.createElement("div");t.className="element-zzz-container",t.style.cssText="position: absolute; top: -10px; right: -5px; pointer-events: none;";for(let s=0;s<this.DISPLAY.ZS_PER_ELEMENT;s++){const n=document.createElement("span");n.className="element-zzz",n.textContent="z",n.style.animationDelay=`${s*1}s`,t.appendChild(n)}e.appendChild(t),this.decorations.push(t)},addSleepCap(e){const t=document.createElement("span");t.className="sleep-cap",t.textContent="\u{1F9E2}",t.style.cssText="position: absolute; top: -20px; right: -15px; font-size: 1.5rem; transform: rotate(15deg); z-index: 50;",e.appendChild(t),this.decorations.push(t)},addSnoreBubble(e){const t=document.createElement("div");t.className="snore-bubble",t.textContent="zzz...",e.appendChild(t),this.decorations.push(t)},createOverlay(){this.overlay=document.createElement("div"),this.overlay.id="sleep-overlay",this.overlay.innerHTML=`
            <div class="sleep-scanlines"></div>
            <canvas id="sleep-canvas"></canvas>
            <div class="sleep-zs-container"></div>
            <div class="sleep-message">
                <span class="sleep-icon">\u{1F4A4}</span>
                <span class="sleep-text">tap to wake</span>
            </div>
        `,document.body.appendChild(this.overlay),this.canvas=document.getElementById("sleep-canvas"),this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),this.resizeHandler=()=>this.resizeCanvas(),window.addEventListener("resize",this.resizeHandler,{passive:!0}),requestAnimationFrame(()=>{this.overlay.classList.add("active")})},resizeCanvas(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight)},drawToaster(e,t,s){const n=this.ctx,i=this.CANVAS.PIXEL_SCALE,a={body:"#c4956a",dark:"#5c3d2e",slot:"#4a2c2a",wing:"#f5f0e6",wingDark:"#d4c4a8",highlight:"#e07b3c"};n.save(),n.translate(e,t),n.fillStyle=a.body,n.fillRect(0,4*i,12*i,8*i),n.fillStyle=a.dark,n.fillRect(0,10*i,12*i,2*i),n.fillStyle=a.slot,n.fillRect(2*i,5*i,3*i,4*i),n.fillRect(7*i,5*i,3*i,4*i),n.fillStyle=a.highlight,n.fillRect(2*i,3*i,3*i,2*i),n.fillRect(7*i,3*i,3*i,2*i);const o=s%2===0?0:-1*i;n.fillStyle=a.wing,n.fillRect(-4*i,(2+o/i)*i,4*i,6*i),n.fillStyle=a.wingDark,n.fillRect(-3*i,(3+o/i)*i,2*i,4*i),n.fillStyle=a.wing,n.fillRect(12*i,(2+o/i)*i,4*i,6*i),n.fillStyle=a.wingDark,n.fillRect(13*i,(3+o/i)*i,2*i,4*i),n.restore()},initToasters(){this.toasters=[];const t=window.innerWidth<this.DISPLAY.MOBILE_BREAKPOINT?this.DISPLAY.TOASTERS_MOBILE:Math.floor(window.innerWidth/200)*this.DISPLAY.TOASTERS_PER_200PX+2;for(let s=0;s<t;s++)this.toasters.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,speed:this.CANVAS.TOASTER_MIN_SPEED+Math.random()*this.CANVAS.TOASTER_SPEED_RANGE,wingFrame:Math.floor(Math.random()*10),wingSpeed:this.CANVAS.WING_SPEED_MIN+Math.floor(Math.random()*this.CANVAS.WING_SPEED_RANGE)})},initZs(){const e=this.overlay.querySelector(".sleep-zs-container");if(!e)return;const t=["small","medium","large"],n=window.innerWidth<this.DISPLAY.MOBILE_BREAKPOINT?this.DISPLAY.Z_COUNT_MOBILE:this.DISPLAY.Z_COUNT_DESKTOP;for(let i=0;i<n;i++){const a=document.createElement("div");a.className=`sleep-z ${t[i%3]}`,a.textContent="Z",a.style.left=`${10+Math.random()*80}%`,a.style.animationDelay=`${Math.random()*4}s`,a.style.animationDuration=`${4+Math.random()*3}s`,e.appendChild(a)}},startAnimation(){let e=0;const t=()=>{!this.isAsleep||!this.ctx||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.toasters.forEach(s=>{s.x+=s.speed,s.y-=s.speed*.6;const n=this.CANVAS.WRAP_MARGIN;s.x>this.canvas.width+n&&(s.x=-n,s.y=Math.random()*this.canvas.height),s.y<-n&&(s.y=this.canvas.height+n,s.x=Math.random()*this.canvas.width),e%s.wingSpeed===0&&s.wingFrame++,this.drawToaster(s.x,s.y,s.wingFrame)}),e++,this.animationFrame=requestAnimationFrame(t))};t()},wakeUp(){this.isAsleep&&(this.prefersReducedMotion()||(this.overlay.classList.add("waking"),this.startleElements()),setTimeout(()=>{this.isAsleep=!1,this.lastActivityTime=Date.now(),this.breathingTimeout&&(clearTimeout(this.breathingTimeout),this.breathingTimeout=null),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),document.body.classList.remove("page-sleeping"),document.body.classList.add("page-waking"),this.overlay&&(this.overlay.classList.remove("active"),this.overlay.classList.add("fading")),setTimeout(()=>{this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.canvas=null,this.ctx=null,this.wakeHandler=null,this.cleanupDecorations(),setTimeout(()=>{document.body.classList.remove("page-waking"),this.cleanupElementClasses()},this.TIMING.ELEMENT_CLEANUP_DELAY)},this.TIMING.OVERLAY_FADE),console.log("%c \u2600\uFE0F Good morning! FOGSIFT is awake and ready. ","background: #f5f0e6; color: #4a2c2a; padding: 10px; font-family: monospace; font-weight: bold;")},this.prefersReducedMotion()?0:this.TIMING.WAKE_FLASH_DURATION))},startleElements(){this.sleepyElements.forEach(({element:e,type:t},s)=>{setTimeout(()=>{e.classList.remove("sleepy","sleepy-breathing"),e.classList.add("startled"),t==="card"&&s<3&&this.addStartledMark(e),t==="button"&&s===0&&this.addStartledMark(e)},s*this.TIMING.STAGGER_STARTLE)})},addStartledMark(e){const t=document.createElement("span");t.className="startled-mark",t.textContent="!",t.style.cssText="position: absolute; top: -25px; right: -10px;",e.appendChild(t),this.decorations.push(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},this.TIMING.STARTLED_MARK_DURATION)},cleanupDecorations(){this.decorations.forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),this.decorations=[]},cleanupElementClasses(){this.sleepyElements.forEach(({element:e})=>{e.classList.remove("sleepy","sleepy-breathing","startled"),this.restoreElement(e)}),this.sleepyElements=[]}};window.SleepMode=SleepMode;const App={version:"0.0.2",_intervals:[],init(){Nav.init(),Modal.init(),this.initClock(),this.initAccessibility(),this.initRotatingWords(),this.logBoot(),SleepMode.init()},initClock(){const e=document.getElementById("utc-clock");if(!e)return;const t=()=>{const s=new Date;e.textContent=s.toISOString().replace("T"," ").substring(0,19)+" UTC"};t(),this._intervals.push(setInterval(t,1e3))},initAccessibility(){const e=document.querySelector(".theme-toggle");if(e){const i=()=>{const o=document.documentElement.getAttribute("data-theme")==="dark";e.setAttribute("aria-pressed",o?"true":"false")};i(),new MutationObserver(i).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]})}const t=document.querySelector(".menu-toggle"),s=document.getElementById("mobile-drawer");if(t&&s){const i=()=>{const o=s.classList.contains("open");t.setAttribute("aria-expanded",o?"true":"false")};new MutationObserver(i).observe(s,{attributes:!0,attributeFilter:["class"]})}s&&s.addEventListener("keydown",i=>{i.key==="Escape"&&Nav.toggleMobile()});const n=document.getElementById("article-modal");n&&n.addEventListener("keydown",i=>{i.key==="Escape"&&Modal.close()})},initRotatingWords(){document.querySelectorAll("[data-words]").forEach(t=>{const s=JSON.parse(t.dataset.words);let n=0;this._intervals.push(setInterval(()=>{t.style.opacity="0",setTimeout(()=>{n=(n+1)%s.length,t.textContent=s[n],t.style.opacity="1"},300)},2500))})},logBoot(){console.log("%c FOGSIFT v"+this.version+" // SYSTEMS NOMINAL ","background: #4a2c2a; color: #e07b3c; padding: 10px; font-family: monospace; font-weight: bold; border-left: 5px solid #0d9488;")}};document.addEventListener("DOMContentLoaded",()=>App.init()),window.addEventListener("unload",()=>{App._intervals.forEach(e=>clearInterval(e))});
